<?xml version="1.0" encoding="utf-8" ?>
<SqlCommand>

  <Command ID="SelectBillMaster">
    <CommandString>
      select * from View_WMS_BillMaster
      where {0}
      order by {1}
    </CommandString>
  </Command>

  <Command ID="SelectBillDetail">
    <CommandString>
      select * from View_BillDetailProduct
      where {0}
      order by {1}
    </CommandString>
  </Command>

  <Command ID="DeleteBill">
    <CommandString>
      delete from  WMS_Bill where BillID in ({0})
    </CommandString>
  </Command>
  
  <Command ID="UpdateCheckBillMaster">
    <CommandString>
      update WMS_Bill set Checker=@Checker,CheckDate=getdate(),State=@State  where BillID in ({0})
    </CommandString>
  </Command>
  
  
  
  <!--入库单-->
  <Command ID="InsertInStockBill">
    <CommandString>
      insert into WMS_Bill(BillID, BillDate, ProductCode, BatchNo, SectionID, PalletQty,BillTypeCode, Memo, Creator, CreateDate, Updater, UpdateDate)
      values( @BillID,@BillDate,@ProductCode,@BatchNo,@SectionID,@PalletQty,@BillTypeCode,@Memo,@Creator, getdate(), @Updater, getdate())
    </CommandString>
  </Command>
  <Command ID="UpdateInStockBill">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, ProductCode=@ProductCode, BatchNo=@BatchNo, SectionID=@SectionID, PalletQty=@PalletQty, Memo=@Memo, Updater=@Updater, UpdateDate=getdate() where BillID=@BillID
    </CommandString>
  </Command>

  <Command ID="SpInStockTask">
    <CommandString>
      Sp_InstockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelInstockTask">
    <CommandString>
      Sp_InStockCancelTask
    </CommandString>
  </Command>
  
  
  <!--出库单-->
 
  <!--到期出库产品-->
  <Command ID="SelectProductAttermOutStock">
    <CommandString>
      select * from VCMD_ProductAttermOutStock
      where {0}
      order by {1}
    </CommandString>
  </Command>
  <!--在库产品-->
  <Command ID="SelectProductInStock">
    <CommandString>
      select * from VCMD_ProductInStock
      where {0}
       
    </CommandString>
  </Command>
  <Command ID="InsertOutStock">
    <CommandString>
      insert into WMS_Bill(BillID, BillDate, ProductCode, BatchNo, SectionID, BillTypeCode,  Creator, CreateDate, Updater, UpdateDate)
      values( @BillID,@BillDate,@ProductCode,@BatchNo,@RowID,@BillTypeCode,@Creator, getdate(), @Updater, getdate())
    </CommandString>
  </Command>
  <Command ID="UpdatePalletOutStock">
    <CommandString>
      update WMS_Pallet set LockQty=Quantity where ProductCode=@ProductCode and BatchNo=@BatchNo and RowID=@RowID
    </CommandString>
  </Command>
  <Command ID="DeleteOutStock">
    <CommandString>
      Sp_DeleteOutStock
    </CommandString>
  </Command>
  <Command ID="SpOutStockTask">
    <CommandString>
      Sp_OutStockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelOutstockTask">
    <CommandString>
      Sp_OutstockCancelTask
    </CommandString>
  </Command>

  <Command ID="UpdateOutStock">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, BillTypeCode=@BillTypeCode , Memo=@Memo, Updater=@Updater, UpdateDate=getdate() where BillID=@BillID
    </CommandString>
  </Command>

  <Command ID="SelectProductDetailView">
    <CommandString>
      select * from View_ProductDetail
      where {0}
      order by {1}
    </CommandString>
  </Command>
  <Command ID="SelectInventoryBillDetail">
    <CommandString>
      select detail.*,cell.CellName,area.AreaName,shelf.ShelfName from WMS_BillDetail detail
      inner join CMD_Cell cell on detail.CellCode=cell.CellCode
      inner join CMD_Area area on cell.AreaCode=area.AreaCode
      inner join CMD_Shelf shelf on cell.ShelfCode=shelf.ShelfCode
      where {0}
      order by {1}
    </CommandString>
  </Command>
   
  
  <!--盘库单-->
  <Command ID="InsertInventoryStockBill">
    <CommandString>
      insert into WMS_BillMaster(BillID,BillDate,AreaCode,BillTypeCode,Memo,Creator,CreateDate,Updater,UpdateDate)
      values(@BillID,@BillDate,@AreaCode,@BillTypeCode,@Memo,@Creator,getdate(),@Updater,getdate())
    </CommandString>
  </Command>
  <Command ID="UpdateInventoryStock">
    <CommandString>
      update WMS_BillMaster set BillDate=@BillDate, AreaCode=@AreaCode,BillTypeCode=@BillTypeCode,Memo=@Memo,Updater=@Updater,UpdateDate=getdate() where BillID=@BillID
    </CommandString>
  </Command>
  <Command ID="InsertInventoryStockDetail">
    <CommandString>
      insert into WMS_BillDetail(BillID,RowID,Quantity,CellCode,Memo)
      values(@BillID,@RowID,@Quantity,@CellCode,@Memo)
    </CommandString>
  </Command>
  <Command ID="SpInventoryStockTask">
    <CommandString>
      Sp_InventorystockTask
    </CommandString>
  </Command>
  <Command ID="SpCancelInventoryStockTask">
    <CommandString>
      Sp_InventorystockCancelTask
    </CommandString>
  </Command>




  <!--现有库存明细查询-->
  <Command ID="SelectProductDetailQuery">
    <CommandString>
      select  cell.AreaName,cell.ShelfName,cell.CellName, product.CategoryName,product.ProductName,Product.ProductNo,
      product.Spec,product.Unit,product.ValidPeriod,product.Description,product.Memo as M,product.PartNo,pallet.*,CONVERT(nvarchar, pallet.InDate,120) as SIndate
      from WMS_Pallet pallet
      left join VCMD_Product product on pallet.ProductCode=product.ProductCode
      left join View_CMD_CELL_ALL Cell on pallet.CellCode=Cell.CellCode
      where {0}
    </CommandString>
  </Command>
  <!--任务查询-->
  <Command ID="SelectTaskQuery">
    <CommandString>
      SELECT Task.*,BillType.BillTypeName,Product.ProductName,Product.ProductCode,Product.ProductNo,Product.CategoryName,Product.Unit,TableState.StateDesc,crane.CraneName,detail.BillID,detail.Quantity,
      (case when Task.TaskType='11' then TASK.StationNo when Task.TaskType in('12','13','14') then Task.CellCode end) FromStation,convert(nvarchar,task.StartDate,120) as SStartDate,convert(nvarchar,task.FinishDate,120) as SFinishDate,
      (case when Task.TaskType in ('11','14') then Task.CellCode when Task.TaskType='12' then TASK.StationNo when Task.TaskType='13' then Task.ToCellCode end) ToStation
      FROM WCS_TASK  Task
      left join  WCS_TaskProductDetail detail on Task.TaskNo=detail.TaskNo
      left join  VCMD_Product product on detail.ProductCode=Product.ProductCode
      left join  CMD_Crane Crane on Task.CraneNo=crane.CraneNo
      left join  CMD_BillType BillType on task.BillTypeCode=billtype.BillTypeCode
      left join  Sys_TableState TableState on TableState.TableName='WCS_TASK' and TableState.FieldName='State' and Task.State=TableState.State
      where {0}
    </CommandString>
   
    
    
    <!--出库明细查询-->
    <Command ID="SelectOutStockQuery">
      <CommandString>
        select task.PalletCode,CellCode,task.FinishDate,Detail.ProductCode,Detail.Barcode,detail.Quantity,Product.CategoryName,Product.ProductNo,
        product.ProductName,product.Spec,product.Unit,product.ValidPeriod,product.Description,product.Memo as M,product.PartNo,main.SourceBillNo,detail.BillID,convert(nvarchar,task.FinishDate,120) as SFinishDate
        from WCS_TASK Task
        left join WCS_TaskProductDetail Detail on Task.TaskNo=Detail.TaskNo
        left join VCMD_Product Product  on Detail.ProductCode=Product.ProductCode
        left join WMS_BillMaster Main on Detail.BillID=main.BillID
        where task.TaskType='12' and task.State=7 and {0}
      </CommandString>
     </Command>
  </Command>
  <!--组盘-->
  <Command ID="SelectWmsPallet">
    <CommandString>
      select pallet.*,product.ProductName,product.Unit,product.ModelNo from WMS_Pallet pallet
      left join CMD_Product product on pallet.ProductCode=product.ProductCode
      where {0}
    </CommandString>
  </Command>
  <Command ID="InsertPallet">
    <CommandString>
      insert into WMS_Pallet(PalletCode,RowID,ProductCode,Quantity,Weight,Memo,Creator,CreateDate,Updater,UpdateDate)
      values(@PalletCode,@RowID,@ProductCode,@Quantity,@Weight,@Memo,@Creator,getdate(),@Updater,getdate())
    </CommandString>
  </Command>
  <Command ID="UpdatePallet">
    <CommandString>
      update wms_pallet set productcode=@productCode,Quantity=@Quantity,Weight=@Weight,Memo=@Memo,Updater=@Updater,UpdateDate=getdate() where PalletCode=@PalletCode and RowID=@RowID
    </CommandString>
  </Command>
  <Command ID="SpCreateTaskByPallet">
    <CommandString>
      Sp_CreateTaskByPallet
    </CommandString>
  </Command>
  <!--超过冲程-->
  <Command ID="SelectProductOutWeight">
    <CommandString>
      select product.*,tmp.quantity from (
      select ProductCode,SUM(Quantity) as quantity from WCS_Task task
      inner join WCS_TaskProductDetail detail on task.TaskNo=detail.TaskNo
      where task.TaskType='11' and SubSate=0 and State='7'
      group by ProductCode ) tmp inner join CMD_Product product on tmp.ProductCode=product.ProductCode
      where tmp.quantity&gt;=product.Weight and product.Weight!=0 and {0}
    </CommandString>
  </Command> 
  <!--显示冲程-->
  <Command ID="SelectProductAllWeight">
    <CommandString>
      select product.*,isnull(tmp.quantity,0)quantity from CMD_Product product left join (select ProductCode,SUM(Quantity) as quantity from WCS_Task task
      inner join WCS_TaskProductDetail detail on task.TaskNo=detail.TaskNo
      where task.TaskType='11'and State='7'and SubSate=0
      group by ProductCode)tmp on product.ProductCode=tmp.ProductCode
      where  product.Weight!=0 and {0}
    </CommandString>
  </Command>
</SqlCommand>